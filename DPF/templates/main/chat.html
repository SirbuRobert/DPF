{% extends 'base.html' %}
{% load static %}

{% block title %}Chat cu {{ destinatar.first_name }} {{ destinatar.last_name }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
        <h1>Conversație cu {{ destinatar.first_name }} {{ destinatar.last_name }}</h1>
        <a href="{% url 'profesori' %}" class="btn btn-secondary">Înapoi la profesori</a>
    </div>

    <div class="card p-4 shadow-sm">
        <p class="text-info fw-bold">Mod Demo: Refresh-ul paginii va simula actualizarea "în timp real".</p>

        <div class="chat-window border rounded p-3 mb-3" style="min-height: 300px; max-height: 50vh; overflow-y: auto; background-color: #f8f9fa;">
            {% for mesaj in mesaje %}
                <div class="d-flex {% if mesaj.expeditor == user %}justify-content-end{% else %}justify-content-start{% endif %} mb-2">
                    <div class="card p-2 {% if mesaj.expeditor == user %}bg-primary text-white{% else %}bg-light border{% endif %}" style="max-width: 70%;">
                        <small class="text-end" style="opacity: 0.7; font-size: 0.75rem;">
                            {{ mesaj.expeditor.first_name }} la {{ mesaj.data_trimitere|date:"H:i" }}
                        </small>
                        <p class="m-0">{{ mesaj.continut }}</p>
                    </div>
                </div>
            {% empty %}
                <p class="text-center text-muted mt-5">Nicio conversație începută. Trimite primul mesaj.</p>
            {% endfor %}
        </div>
        
        <form method="POST">
            {% csrf_token %}
            <div class="input-group">
                <textarea name="continut" class="form-control" rows="2" placeholder="Scrie mesajul tău..." required></textarea>
                <button type="submit" class="btn btn-success">Trimite</button>
            </div>
        </form>
    </div>
</div>
{% endblock content %}